<!doctype html>
<html lang="vi">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stable Diffusion Demo WebUI</title>
  <link rel="stylesheet" href="/assets/styles.css">
</head>

<body>
  <div class="wrap">

    <div class="topbar">
      <div class="title">
        <h1>Stable Diffusion Demo WebUI</h1>
        <p class="desc">
          Chọn model LoRA → Load → nhập prompt → Generate. Ảnh output hiển thị trực tiếp và có nút xem full / tải về.
        </p>
      </div>

      <div class="right">
        <div class="badge" title="Trạng thái model">
          <div class="dot" id="dot"></div>
          <div class="txt">
            <b id="statusTop">UNKNOWN</b>
            <span id="statusText">—</span>
          </div>
        </div>
        <div class="chip" id="chipApi" title="Click để copy API base">
          API <code id="apiBaseLabel">(auto)</code>
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: Controls -->
      <div class="card">
        <div class="cardHeader">
          <div class="h">
            <b>Controls</b>
            <span>Model, prompt và tham số inference (slider kéo thả)</span>
          </div>
          <div class="row tight" style="gap:10px;">
            <button class="btn btnGhost btnSmall" id="btnStatus">Refresh status</button>
          </div>
        </div>

        <div class="cardBody">
          <label>Model (LoRA)</label>
          <div class="row">
            <select id="modelSelect"></select>
            <button class="btn btnPrimary btnSmall" id="btnLoad">Load / Reload</button>
          </div>
          <div class="hint" id="modelHint" style="margin-top:8px;">
            Tip: Đổi model có thể Load hoặc cứ Generate (BE auto-switch).
          </div>

          <label>Prompt <span class="req">*</span></label>
          <textarea id="prompt" placeholder="Ví dụ: Ghibli style, hand drawn, cozy scene..."></textarea>

          <div class="row" style="margin-top:6px;">
            <div>
              <label>Width</label>
              <div class="sliderWrap">
                <div class="sliderTop">
                  <span class="val">Value: <b id="wVal">512</b></span>
                  <span class="hint">256–768 (chia hết cho 8)</span>
                </div>
                <input id="width" type="range" min="256" max="768" step="8" value="512">
              </div>
            </div>
            <div>
              <label>Height</label>
              <div class="sliderWrap">
                <div class="sliderTop">
                  <span class="val">Value: <b id="hVal">512</b></span>
                  <span class="hint">256–768 (chia hết cho 8)</span>
                </div>
                <input id="height" type="range" min="256" max="768" step="8" value="512">
              </div>
            </div>
          </div>

          <div class="row" style="margin-top:6px;">
            <div>
              <label>Steps</label>
              <div class="sliderWrap">
                <div class="sliderTop">
                  <span class="val">Value: <b id="sVal">30</b></span>
                  <span class="hint">10–50</span>
                </div>
                <input id="steps" type="range" min="10" max="50" step="1" value="30">
              </div>
            </div>
            <div>
              <label>CFG Scale</label>
              <div class="sliderWrap">
                <div class="sliderTop">
                  <span class="val">Value: <b id="cVal">7.5</b></span>
                  <span class="hint">1.0–12.0</span>
                </div>
                <input id="cfgScale" type="range" min="1" max="12" step="0.1" value="7.5">
              </div>
            </div>
          </div>

          <div class="row" style="margin-top:6px;">
            <div>
              <label>Seed (optional)</label>
              <input id="seed" type="number" placeholder="vd 42 (để trống → random)">
              <div class="hint" style="margin-top:8px;">Seed giúp tái lập kết quả.</div>
            </div>
            <div>
              <label>Negative prompt (optional)</label>
              <input id="neg" placeholder="vd: nsfw, nude, bad anatomy">
              <div class="hint" style="margin-top:8px;">Prompt phụ để “tránh” một số đặc điểm.</div>
            </div>
          </div>

          <div class="row tight" style="margin-top: 14px; align-items:center;">
            <button class="btn btnPrimary btnSmall" id="btnGen" disabled>Generate</button>
            <span class="hint" id="hintLine">Model chưa load → không cho generate.</span>
            <span class="kbd">Ctrl/⌘ + Enter</span>
          </div>

          <div class="error" id="err"></div>

          <details>
            <summary>Debug (request/response)</summary>
            <pre id="debug">(trống)</pre>
          </details>
        </div>
      </div>

      <!-- RIGHT: Result -->
      <div class="card">
        <div class="cardHeader">
          <div class="h">
            <b>Result</b>
            <span>Ảnh output + thời gian inference</span>
          </div>
        </div>

        <div class="preview">
          <div class="frame">
            <div class="overlay" id="overlay">
              <div class="loader">
                <div class="spin"></div>
                <div id="overlayText">Running...</div>
              </div>
            </div>

            <div class="placeholder" id="ph">
              <div class="spark" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M12 2l1.3 6.1L19 10l-5.7 1.9L12 18l-1.3-6.1L5 10l5.7-1.9L12 2z" stroke="white"
                    stroke-width="1.6" opacity=".95" />
                </svg>
              </div>
              <div>Chưa có ảnh. Hãy <b>Load model</b> rồi bấm <b>Generate</b>.</div>
            </div>

            <img id="img" alt="output" />
          </div>

          <div class="meta">
            <div class="left">
              <b id="metaTitle">Inference</b>
              <span id="timeInfo">—</span>
            </div>
            <div class="actions">
              <a class="linkBtn" id="openFull" target="_blank" rel="noreferrer" style="display:none">Xem full</a>
              <a class="linkBtn" id="download" download="sd_output.png" style="display:none">Download</a>
            </div>
          </div>

          <div class="hint">
            Nếu ảnh không hiện: xem Network có request <code>/images/...</code> bị 404/500 không.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="/assets/app.js"></script>
</body>

</html>